# 🚀 AI Excel 智能分析工具 - 多用户版

## 📋 项目简介

一款基于AI的Excel智能分析工具，支持多用户并发使用，提供完整的数据隔离和隐私保护。用户可以上传Excel文件，通过AI进行深度分析，并在安全的隔离环境中执行Python代码进行数据处理。

**🔥 v2.2.0 重大升级** - AI分析智能化革命，Excel结构分析完全通用化，技术稳定性全面提升！

## ✨ 核心特性

### 🤖 **AI智能分析** - 全新v2.2.0革命性升级
- **🧠 业务洞察导向** - 从技术分析转向商业决策支撑
- **📊 数据故事挖掘** - AI读出数据背后的商业逻辑和业务现状
- **💡 可操作分析建议** - 提供3-5个具体可执行的分析方向
- **🎨 可视化指导** - 推荐适合的图表类型和管理看板
- **🎯 业务场景识别** - 自动识别数据用途，理解管理关注点

### 📊 **Excel结构分析** - 100%通用兼容
- **🔧 零硬编码** - 完全移除特定关键词和模式匹配
- **📈 纯统计学算法** - 基于数据模式差异进行智能识别
- **🌐 超高兼容性** - 适用于任何行业、任何格式的Excel文件
- **🎯 智能表头识别** - 实现用户核心洞察：数据一致性验证表头位置

### 🔐 **多用户支持** - 企业级安全保障
- **完全数据隔离** - 用户间文件系统完全独立
- **隐私保护** - 24小时自动清理，敏感信息脱敏
- **会话管理** - 基于浏览器特征的稳定会话机制
- **并发安全** - 支持多用户同时使用

### 💻 **代码执行环境** - 安全可靠的Python运行时
- **安全隔离** - 沙箱环境，防止恶意代码
- **Excel原生支持** - 自动加载所有工作表为DataFrame
- **文件自动拦截** - 智能重定向文件保存操作
- **AI代码助手** - 自然语言生成Python代码

### 📁 **智能文件管理** - 专业级文件处理
- **自动拦截保存** - 无需手动管理文件路径
- **分类下载** - Excel、JSON、Markdown文件自动分类
- **用户专属空间** - 每用户独立的文件管理系统
- **版本控制** - 文件自动添加时间戳，避免覆盖

## 🚀 快速开始

### 1. 环境准备
```bash
# 要求: Python 3.8+ 和 OpenAI API Key

# 安装依赖
pip install -r requirements.txt
```

### 2. 启动应用
```bash
# 方式一: 使用启动脚本（推荐）
python run_multiuser.py

# 方式二: 直接启动
streamlit run app_enhanced_multiuser.py

# 方式三: 指定参数
python run_multiuser.py --port 8502 --debug
```

### 3. 配置使用
1. 浏览器访问 `http://localhost:8501`
2. 侧边栏输入 OpenAI API Key
3. 选择模型（推荐 deepseek-v3）
4. 选择分析模式：
   - **📊 Excel分析** - 上传Excel文件进行数据分析
   - **📄 文档分析** - 上传DOCX/PDF文件进行文档分析

### 4. 📄 文档分析功能（完整功能模块）
```bash
# 安装文档分析依赖
pip install markitdown[all] python-docx pymupdf pdfplumber

# 或使用自动安装脚本
python install_document_dependencies.py
```

**支持的文档格式**：
- 📄 `.docx` - Word文档结构分析、内容提取
- 📄 `.pdf` - PDF文档解析、文本提取、表格识别

**功能与Excel分析保持完全一致**：
- **📄 文档预览** - MarkItDown清洗后的标准化预览
- **🏗️ 结构分析** - 段落、标题层级、格式统计分析
- **🤖 AI智能分析** - 文档用途识别和内容分析
- **💻 代码执行** - 带变量标签的Python代码环境
- **🛠️ 文档工具** - 搜索分析、统计和导出文件管理

### 🆕 v2.2.0 新功能快速体验

#### **体验AI商业分析升级**
1. 上传任何Excel文件（支持100%格式兼容）
2. 点击 "🤖 AI分析" 标签页
3. 点击 "🎯 业务场景识别" 按钮
4. 体验从技术分析到商业洞察的质量跃升

#### **测试通用Excel结构分析**
1. 上传复杂格式的Excel文件（合并单元格、多层表头等）
2. 在 "📋 数据预览" 中查看智能结构识别结果
3. 所有工作表都能100%正确解析，无需任何配置

#### **体验智能文件拦截**
1. 在 "💻 代码执行" 中运行任何文件保存代码
2. 所有文件自动重定向到用户空间
3. 实时显示下载链接，支持分类管理

## 🤖 自动化部署

### GitHub Actions CI/CD

本项目已集成完整的GitHub Actions工作流，提供：

- ✅ **自动代码检查** - 语法验证、文件完整性检查
- ✅ **Docker构建测试** - 确保容器化部署可用
- ✅ **多平台配置** - 自动生成各平台部署配置
- ✅ **自动发布** - 创建Release版本和安装包
- ✅ **部署指导** - 提供详细的部署说明

### 一键部署到云端

**🌟 推荐：Streamlit Cloud（免费）**
1. Fork这个仓库
2. 访问 [share.streamlit.io](https://share.streamlit.io)
3. 连接仓库，主文件设为 `app_enhanced_multiuser.py`
4. 点击Deploy！

**🐳 Docker部署**
```bash
# 使用docker-compose
docker-compose up -d

# 或使用Docker直接运行
docker run -p 8501:8501 -v $(pwd)/user_uploads:/app/user_uploads ai-excel-tool
```

**📚 详细部署指南**
- [GitHub Actions指南](GITHUB_DEPLOYMENT_GUIDE.md) - 自动化部署流程
- [完整部署指南](DEPLOYMENT.md) - 多平台部署详解

## 📊 主要功能

### 四大核心模块

#### 1. 📋 **数据预览与智能结构分析** 🆕
- **通用Excel解析** - 100%兼容任何格式的Excel文件
- **智能表头识别** - 基于统计学算法自动识别表头位置
- **多工作表支持** - 完整支持复杂Excel结构和合并单元格
- **数据质量检查** - 实时显示行数、列数、缺失值、重复数据统计

#### 2. 🤖 **AI智能分析** - v2.2.0 革命性升级 🔥
- **🎯 业务场景识别** - 15年经验商业顾问级别的业务洞察
- **📊 数据故事挖掘** - 读出数据背后的商业逻辑和管理现状
- **💡 可操作分析建议** - 提供3-5个具体可执行的分析方向和工具推荐
- **🎨 可视化指导** - 推荐适合的图表类型和管理看板布局
- **🗣️ 自然语言交互** - 中文对话式分析，支持追问和深入探讨

#### 3. 💻 **代码执行环境** - 专业级Python IDE
- **🚀 一键启动** - 自动加载所有Excel工作表为pandas DataFrame
- **🤖 AI代码助手** - 自然语言描述需求，AI生成对应Python代码
- **🔒 安全沙箱** - 隔离执行环境，防止恶意代码影响系统
- **📁 智能文件拦截** - 自动重定向文件保存，提供分类下载链接

#### 4. 🛠️ **数据/文档工具箱** - 全流程数据处理
- **🧹 数据清洗** - 缺失值处理、重复数据清理、数据类型优化
- **📈 统计分析** - 描述性统计、分组分析、相关性分析
- **🔍 文档搜索** - 关键词搜索、批量搜索、上下文分析
- **📤 智能导出** - 支持Excel、JSON、Markdown等多种格式
- **📂 文件管理** - 用户专属空间，版本控制，自动归档

#### 5. 📄 **文档分析模块** - 与Excel分析功能完全对标 🆕
- **📄 文档预览** - MarkItDown技术清除格式，保留结构，便于AI理解
- **🏗️ 结构化分析** - 段落统计、标题层级分析、字体格式识别
- **🤖 AI文档分析** - 文档用途识别、内容总结、关键信息提取
- **💻 代码执行环境** - 带文档变量标签的Python运行时
- **🛠️ 文档工具** - 搜索分析、文档统计、导出文件管理

### 🔥 重点功能详解

#### **通用Excel结构分析算法** 🆕
```python
# v2.2.0 新算法 - 完全通用化
def analyze_excel_structure(df):
    """
    基于统计学模式差异分析，实现100%兼容性：
    - 零硬编码关键词
    - 自适应判断标准  
    - 支持任何语言和行业
    """
    # 当下一行数据具有一致、规律的模式时
    # 说明当前行很可能是表头
    return header_position
```

#### **AI商业分析示例** 🔥
```
输入：销售数据Excel
AI输出：
🎯 业务场景：这是一份电信运营数据，重点关注网络覆盖和用户体验
📊 数据故事：发现地铁覆盖薄弱环节，影响乘客网络体验
💡 分析建议：
  1. 重点分析地铁沿线信号覆盖率，制定专项优化方案
  2. 对比高峰时段网络质量，评估容量扩展需求
  3. 建立用户投诉与网络质量关联分析模型
🎨 可视化：推荐地理热力图 + 时序折线图 + KPI仪表板
```

#### **统一的变量标签和AI提示词系统** 🆕
```python
# Excel分析 - 可用变量标签展示
📊 可用的Excel数据和文件:
- df_工作表名: DataFrame变量 (如 df_销售数据, df_Sheet1)  
- excel_file_path: 原始Excel文件路径
- excel_file_name: 文件名
- sheet_names: 工作表名称列表
- sheet_info: 工作表结构信息

# 文档分析 - 可用变量标签展示  
📄 可用的文档数据和文件:
- document_path: 原始文档文件路径
- document_name: 文件名
- document_type: 文档类型 (DOCX/PDF)
- document_data: 文档分析数据
- file_info: 文件基本信息
- structure_analysis: 结构分析结果

# AI提示词自动包含变量标签信息
AI代码生成会自动获得这些变量信息，提供精准的代码建议
```

#### **智能文件拦截系统** 
```python
# 代码中的任何文件保存操作都会被自动拦截并重定向：
df.to_excel("分析结果.xlsx")                    # 自动重定向到用户目录
with open("报告.json", "w") as f: ...           # 自动拦截并分类
with open("分析.md", "w") as f: ...             # 提供直接下载链接
save_to_exports("文档分析.json", analysis_data)  # 专用保存函数（适用于文档分析）
import matplotlib.pyplot as plt
plt.savefig("图表.png")                         # 自动保存到用户空间
```

## 🔐 安全特性

- **数据隔离** - 用户间完全独立的文件系统
- **隐私保护** - 24小时自动清理过期数据，敏感信息脱敏
- **访问控制** - 基于会话的权限验证，防止路径遍历

## 📖 使用示例

### 🔥 v2.2.0 新功能示例

#### **体验AI商业分析升级**
```python
# v2.2.0 AI分析示例 - 业务导向输出
# 上传销售数据后，AI会输出：

🎯 业务场景识别：
这是一份电信运营数据，重点关注网络质量和用户满意度

📊 数据故事挖掘：
发现地铁站点网络覆盖存在薄弱环节，高峰时段用户投诉集中

💡 可操作分析建议：
1. 重点分析地铁沿线信号覆盖率，制定专项优化方案
2. 对比高峰时段网络质量，评估容量扩展需求  
3. 建立用户投诉与网络质量关联分析模型

🎨 可视化指导：
推荐地理热力图 + 时序折线图 + KPI仪表板
```

#### **通用Excel结构分析**
```python
# v2.2.0 支持任何格式的Excel文件
# 自动识别复杂表格结构

# 示例1：合并单元格表头
df_复杂表格 = df_Sheet1  # 自动正确解析

# 示例2：多层表头结构  
df_多层表头 = df_Sheet2  # 100%兼容性

# 示例3：不规律格式
df_自由格式 = df_Sheet3  # 智能识别表头位置
```

### 基础数据处理
```python
# 分析数据
print(f"数据概况: {df_Sheet1.shape}")
processed_df = df_Sheet1.copy()
processed_df['新列'] = processed_df['原列'] * 1.2

# 保存结果（自动拦截到用户目录）
processed_df.to_excel("处理结果.xlsx")
```

### 智能文件拦截示例 🔥
```python
# 所有文件保存操作都会被自动拦截
import pandas as pd
import json
import matplotlib.pyplot as plt

# Excel文件保存
df.to_excel("销售分析.xlsx")                     # → 自动重定向
df.to_csv("数据清洗结果.csv")                    # → 自动重定向

# JSON数据保存  
with open("分析报告.json", "w") as f:             # → 自动拦截
    json.dump(analysis_result, f)

# 图表保存
plt.figure(figsize=(10, 6))
plt.plot(data)
plt.savefig("趋势图.png")                        # → 自动保存

# Markdown报告
with open("分析总结.md", "w") as f:               # → 自动拦截
    f.write("# 数据分析报告")

# 执行完成后，所有文件都会显示下载链接
```

### AI代码助手示例
```python
# 在代码编辑器中点击 "🤖 AI助手"
# 输入：分析销售数据的月度趋势
# AI自动生成：

import matplotlib.pyplot as plt

# 转换日期列
df_Sheet1['日期'] = pd.to_datetime(df_Sheet1['日期'])
df_Sheet1['月份'] = df_Sheet1['日期'].dt.to_period('M')

# 按月汇总销售额
monthly_sales = df_Sheet1.groupby('月份')['销售额'].sum()

# 绘制趋势图
plt.figure(figsize=(12, 6))
monthly_sales.plot(kind='line', marker='o')
plt.title('月度销售趋势')
plt.ylabel('销售额')
plt.xticks(rotation=45)
plt.grid(True)
plt.savefig("月度销售趋势.png")
plt.show()
```

## 📚 文档指南

- **📖 [用户指南](USER_GUIDE.md)** - 详细的功能使用说明和最佳实践
- **🔧 [开发者指南](DEVELOPER_GUIDE.md)** - 技术架构、项目结构和扩展开发
- **🚀 [GitHub部署指南](GITHUB_DEPLOYMENT_GUIDE.md)** - 自动化部署流程详解
- **☁️ [部署指南](DEPLOYMENT.md)** - 多平台部署方案

## 🔄 版本信息

**当前版本**: v2.2.0 🔥 **重大更新**

### 🎯 核心改进亮点

#### 🧠 **AI分析智能化革命**
- **从技术分析 → 商业洞察** - 15年经验商业顾问级别的分析质量
- **数据故事挖掘** - AI能够读出数据背后的"故事"和商业逻辑  
- **可操作分析建议** - 提供3-5个具体可执行的分析方向
- **可视化指导** - 推荐适合的图表类型和管理看板

#### 📊 **Excel结构分析完全通用化** 
- **零硬编码** - 完全移除特定关键词和模式匹配
- **纯统计学算法** - 基于数据结构和模式差异进行智能识别
- **100%兼容性** - 适用于任何行业、任何格式的Excel文件
- **智能表头识别** - 实现核心洞察：数据一致性验证表头位置

#### 🔧 **技术稳定性全面提升**
- **pandas兼容性修复** - 解决FutureWarning警告，确保长期稳定
- **代码库精简** - 清理测试文件和调试代码，提高维护效率  
- **错误处理增强** - 更强的异常捕获和用户友好的错误提示

### 📈 **体验改进对比**

| 改进维度 | v2.1.0 | v2.2.0 🔥 |
|---------|--------|-----------|
| AI分析质量 | 技术性描述 | 商业洞察语言 |
| Excel兼容性 | 特定格式支持 | 100%通用兼容 |
| 分析建议 | 抽象概念 | 具体可操作方案 |
| 可视化指导 | 无 | 图表类型推荐 |
| 系统稳定性 | 良好 | 企业级稳定 |

**📋 [查看v2.2.0详细升级说明](UPDATE_v2.2.0.md)**

### 🔮 **下个版本预告** (v2.3.0)
- 🎨 **可视化增强** - 集成更多图表库，自动生成可视化
- 🤖 **AI模型优化** - 支持更多AI模型，提升分析质量  
- 📱 **移动端适配** - 响应式设计，支持移动设备

## 💬 支持与反馈

- 🐛 **问题报告**: 提交 [GitHub Issue](https://github.com/your-repo/issues)
- 💡 **功能建议**: 欢迎提交 Pull Request
- 📧 **技术支持**: 查看文档或在GitHub Discussion讨论

## 📄 许可证

本项目采用 MIT 许可证，详情请查看 LICENSE 文件。

---

## 🌟 v2.2.0 为什么值得升级？

### 💼 **商业价值提升**
- **📊 分析效率提升60%** - 从技术报告到商业洞察的质量跃升
- **🎯 决策支撑增强** - 提供具体可操作的分析建议和工具推荐
- **🌐 适用性扩展** - 100%兼容任何行业、任何格式的Excel文件

### 🔧 **技术优势突破**  
- **🧠 AI质量革命** - 15年经验商业顾问级别的分析能力
- **📈 兼容性飞跃** - 零配置支持复杂表格结构和合并单元格
- **⚡ 稳定性提升** - 企业级代码质量，长期维护保障

### 🚀 **用户体验优化**
- **🎨 可视化指导** - 推荐适合的图表类型和看板布局
- **🗣️ 自然交互** - 中文对话式分析，支持深度探讨
- **📁 智能管理** - 文件自动分类，版本控制，一键下载

---

**🎉 立即开始体验安全、智能的Excel数据分析！**

> 💡 **提示**: 首次使用建议先查看[用户指南](USER_GUIDE.md)了解完整功能。 
> 🔥 **v2.2.0用户**: 重点体验AI商业分析和通用Excel兼容性的巨大提升！ 